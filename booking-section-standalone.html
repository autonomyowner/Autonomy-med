<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Section Réservation - Clinique Dentaire</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap');
    
    :root {
      --accent-primary: #2c5aa0;
      --accent-secondary: #00b4d8;
      --accent-text: #333333;
      --accent-text-light: #6c757d;
      --background-secondary: #f8f9fa;
    }

    body {
      font-family: 'Montserrat Alternates', system-ui, sans-serif;
      background: linear-gradient(135deg, 
        rgba(44, 90, 160, 0.03) 0%, 
        rgba(248, 249, 250, 0.5) 50%, 
        rgba(0, 180, 216, 0.02) 100%
      );
    }

    .luxury-card {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.95) 0%, 
        rgba(248, 249, 250, 0.9) 25%, 
        rgba(233, 236, 239, 0.85) 75%, 
        rgba(255, 255, 255, 0.9) 100%
      );
      backdrop-filter: blur(10px);
      border: 1px solid rgba(44, 90, 160, 0.15);
      box-shadow: 
        0 4px 16px rgba(0, 0, 0, 0.08),
        0 8px 32px rgba(44, 90, 160, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
      border-radius: 1rem;
    }

    .lux-heading {
      font-family: 'Playfair Display', serif;
      letter-spacing: -0.02em;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .mafia-heading {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: -0.035em;
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(44, 90, 160, 0.1);
    }

    .service-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .service-card:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 12px 40px rgba(44, 90, 160, 0.15),
        0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .service-card.selected {
      border-color: var(--accent-primary);
      background: linear-gradient(135deg, 
        rgba(44, 90, 160, 0.05) 0%, 
        rgba(255, 255, 255, 0.95) 100%
      );
    }

    .form-input {
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.98) !important;
      border: 1px solid rgba(44, 90, 160, 0.15);
      color: #333333 !important;
      font-size: 16px;
      line-height: 1.5;
    }

    .form-input:focus {
      border-color: var(--accent-primary);
      background: rgba(255, 255, 255, 1) !important;
      color: #333333 !important;
      box-shadow: 
        0 0 0 3px rgba(44, 90, 160, 0.1),
        0 4px 12px rgba(44, 90, 160, 0.1);
      outline: none;
    }

    .form-input::placeholder {
      color: #9ca3af;
      opacity: 1;
    }

    .form-input:focus::placeholder {
      color: #d1d5db;
    }

    /* Ensure all form elements have proper text visibility */
    input.form-input,
    select.form-input,
    textarea.form-input {
      background: rgba(255, 255, 255, 0.98) !important;
      color: #333333 !important;
      font-weight: 400;
      -webkit-text-fill-color: #333333 !important;
      caret-color: #333333;
    }

    input.form-input:focus,
    select.form-input:focus,
    textarea.form-input:focus {
      background: rgba(255, 255, 255, 1) !important;
      color: #333333 !important;
      -webkit-text-fill-color: #333333 !important;
    }

    /* Override any Tailwind classes that might interfere */
    .form-input {
      background-color: rgba(255, 255, 255, 0.98) !important;
      color: #333333 !important;
    }

    /* Specific styling for different input types */
    input[type="text"].form-input,
    input[type="email"].form-input,
    input[type="tel"].form-input {
      color: #333333 !important;
      text-shadow: none !important;
      -webkit-appearance: none;
      appearance: none;
    }

    /* Debug: Ensure visibility with high contrast */
    .form-input:not(:placeholder-shown) {
      color: #000000 !important;
      font-weight: 500 !important;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 
        0 4px 16px rgba(44, 90, 160, 0.3),
        0 8px 32px rgba(0, 180, 216, 0.15);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 
        0 6px 20px rgba(44, 90, 160, 0.4),
        0 12px 40px rgba(0, 180, 216, 0.2);
    }

    .status-message {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen py-12">
  <div class="container mx-auto px-4 max-w-7xl">
    <!-- Section Header -->
    <div class="text-center mb-16">
      <div class="inline-block px-6 py-3 luxury-card text-blue-700 text-sm font-semibold tracking-widest uppercase mb-6">
        PRENDRE RENDEZ-VOUS
      </div>
      <h2 class="mafia-heading text-4xl md:text-5xl lg:text-6xl text-gray-800 tracking-tight leading-tight mb-6">
        Réservez Votre
        <span class="bg-gradient-to-r from-blue-700 to-cyan-500 bg-clip-text text-transparent block">
          Consultation
        </span>
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Planifiez votre visite en quelques clics. Choisissez votre service, 
        votre créneau préféré et recevez une confirmation instantanée.
      </p>
    </div>

    <!-- Status Messages -->
    <div id="statusMessages" class="mb-8"></div>

    <div class="grid lg:grid-cols-3 gap-8">
      
      <!-- Services Selection -->
      <div class="lg:col-span-1">
        <div class="luxury-card p-6 sticky top-8">
          <h3 class="lux-heading text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
            <i class="fas fa-star text-blue-700"></i>
            <span class="bg-gradient-to-r from-blue-700 to-cyan-500 bg-clip-text text-transparent">Nos Services</span>
          </h3>
          
          <div class="space-y-3" id="servicesContainer">
            <!-- Services will be dynamically populated -->
          </div>

          <div id="selectedServiceInfo" class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200 hidden">
            <div class="flex items-center gap-3" id="selectedServiceDetails">
              <!-- Selected service details -->
            </div>
          </div>
        </div>
      </div>

      <!-- Booking Form -->
      <div class="lg:col-span-2">
        <div class="luxury-card p-8">
          <form id="appointmentForm" class="space-y-8">
            
            <!-- Personal Information -->
            <div class="space-y-6">
              <h3 class="lux-heading text-xl font-bold text-gray-800 flex items-center gap-3">
                <i class="fas fa-user text-blue-700"></i>
                <span class="bg-gradient-to-r from-blue-700 to-cyan-500 bg-clip-text text-transparent">Informations Personnelles</span>
              </h3>
              
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-semibold text-gray-800 mb-2">
                    Nom Complet *
                  </label>
                  <input
                    type="text"
                    name="patientName"
                    placeholder="Votre nom complet"
                    class="form-input w-full px-4 py-3 rounded-lg"
                    required
                  />
                  <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-800 mb-2">
                    Téléphone *
                  </label>
                  <div class="relative">
                    <i class="fas fa-phone absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input
                      type="tel"
                      name="patientPhone"
                      placeholder="06 12 34 56 78"
                      class="form-input w-full pl-10 pr-4 py-3 rounded-lg"
                      required
                    />
                  </div>
                  <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                </div>
              </div>

              <div>
                <label class="block text-sm font-semibold text-gray-800 mb-2">
                  Adresse Email *
                </label>
                <div class="relative">
                  <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                  <input
                    type="email"
                    name="patientEmail"
                    placeholder="votre.email@example.com"
                    class="form-input w-full pl-10 pr-4 py-3 rounded-lg"
                    required
                  />
                </div>
                <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
              </div>
            </div>

            <!-- Date and Time Selection -->
            <div class="space-y-6">
              <h3 class="lux-heading text-xl font-bold text-gray-800 flex items-center gap-3">
                <i class="fas fa-calendar text-blue-700"></i>
                <span class="bg-gradient-to-r from-blue-700 to-cyan-500 bg-clip-text text-transparent">Date & Heure</span>
              </h3>
              
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-semibold text-gray-800 mb-2">
                    Date Préférée *
                  </label>
                  <select name="date" class="form-input w-full px-4 py-3 rounded-lg" required>
                    <option value="">Choisir une date</option>
                    <!-- Dates will be populated dynamically -->
                  </select>
                  <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-800 mb-2">
                    Créneaux Disponibles *
                  </label>
                  <select name="time" class="form-input w-full px-4 py-3 rounded-lg" required disabled>
                    <option value="">Sélectionner d'abord une date</option>
                  </select>
                  <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                  <div id="availabilityStatus" class="mt-1 text-sm text-gray-500"></div>
                </div>
              </div>
            </div>

            <!-- Additional Notes -->
            <div class="space-y-6">
              <div>
                <label class="block text-sm font-semibold text-gray-800 mb-2">
                  Notes Supplémentaires (Optionnel)
                </label>
                <textarea
                  name="notes"
                  rows="4"
                  placeholder="Décrivez vos préoccupations ou demandes spéciales..."
                  class="form-input w-full px-4 py-3 rounded-lg resize-none"
                ></textarea>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="pt-6">
              <button
                type="submit"
                class="btn-primary w-full px-8 py-4 rounded-lg text-lg font-semibold flex items-center justify-center gap-3"
                id="submitBtn"
              >
                <i class="fas fa-calendar-plus"></i>
                Confirmer le Rendez-vous
              </button>

              <p class="mt-4 text-center text-sm text-gray-500">
                En confirmant, vous acceptez nos conditions d'utilisation et notre politique de confidentialité.
                Vous recevrez un email de confirmation immédiatement.
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Additional Information -->
    <div class="mt-16">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="luxury-card p-6 text-center">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-clock text-blue-700"></i>
          </div>
          <h3 class="lux-heading text-lg font-bold text-gray-800 mb-2">Horaires Flexibles</h3>
          <p class="text-gray-600">
            Du lundi au vendredi, 9h-17h. Choisissez le créneau qui vous convient le mieux.
          </p>
        </div>

        <div class="luxury-card p-6 text-center">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-check-circle text-blue-700"></i>
          </div>
          <h3 class="lux-heading text-lg font-bold text-gray-800 mb-2">Confirmation Instantanée</h3>
          <p class="text-gray-600">
            Recevez immédiatement votre confirmation par email avec tous les détails.
          </p>
        </div>

        <div class="luxury-card p-6 text-center">
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-star text-blue-700"></i>
          </div>
          <h3 class="lux-heading text-lg font-bold text-gray-800 mb-2">Soins d'Excellence</h3>
          <p class="text-gray-600">
            Équipe de spécialistes et équipements modernes pour votre confort.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Dental services data
    const dentalServices = [
      { value: "consultation", label: "Consultation", price: "2,500 DA", icon: "👨‍⚕️" },
      { value: "cleaning", label: "Détartrage", price: "4,000 DA", icon: "🦷" },
      { value: "filling", label: "Plombage", price: "6,000 DA", icon: "🔧" },
      { value: "crown", label: "Couronne", price: "35,000 DA", icon: "👑" },
      { value: "whitening", label: "Blanchiment", price: "15,000 DA", icon: "✨" },
      { value: "implant", label: "Implant", price: "80,000 DA", icon: "🔩" },
      { value: "orthodontics", label: "Orthodontie", price: "120,000 DA", icon: "🦷" },
      { value: "emergency", label: "Urgence", price: "Variable", icon: "🚨" },
    ];

    let selectedService = '';
    let availableSlots = [];

    // Initialize the booking system
    document.addEventListener('DOMContentLoaded', function() {
      populateServices();
      populateDates();
      setupEventListeners();
    });

    function populateServices() {
      const container = document.getElementById('servicesContainer');
      
      dentalServices.forEach(service => {
        const serviceCard = document.createElement('div');
        serviceCard.className = 'service-card p-4 rounded-xl border-2 border-gray-200';
        serviceCard.onclick = () => selectService(service.value);
        serviceCard.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-2xl">${service.icon}</span>
              <div>
                <p class="font-medium text-gray-800">${service.label}</p>
                <p class="text-sm text-gray-500">${service.price}</p>
              </div>
            </div>
            <i class="fas fa-check-circle text-blue-700 hidden check-icon"></i>
          </div>
        `;
        container.appendChild(serviceCard);
      });
    }

    function selectService(serviceValue) {
      selectedService = serviceValue;
      const service = dentalServices.find(s => s.value === serviceValue);
      
      // Update service cards
      document.querySelectorAll('.service-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.check-icon').classList.add('hidden');
      });
      
      event.currentTarget.classList.add('selected');
      event.currentTarget.querySelector('.check-icon').classList.remove('hidden');
      
      // Update selected service info
      const infoContainer = document.getElementById('selectedServiceInfo');
      const detailsContainer = document.getElementById('selectedServiceDetails');
      
      detailsContainer.innerHTML = `
        <span class="text-2xl">${service.icon}</span>
        <div>
          <p class="font-medium text-blue-700">${service.label}</p>
          <p class="text-sm text-gray-600">Prix: ${service.price}</p>
        </div>
      `;
      
      infoContainer.classList.remove('hidden');
      
      // Update form
      document.querySelector('select[name="serviceType"]').value = serviceValue;
    }

    function populateDates() {
      const dateSelect = document.querySelector('select[name="date"]');
      const today = new Date();
      
      // Generate next 14 days (excluding weekends)
      for (let i = 1; i <= 14; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        
        // Skip weekends
        if (date.getDay() !== 0 && date.getDay() !== 6) {
          const option = document.createElement('option');
          option.value = date.toISOString().split('T')[0];
          option.textContent = date.toLocaleDateString('fr-FR', { 
            weekday: 'long', 
            day: 'numeric', 
            month: 'long' 
          });
          dateSelect.appendChild(option);
        }
      }
    }

    function setupEventListeners() {
      // Date change listener
      document.querySelector('select[name="date"]').addEventListener('change', function(e) {
        if (e.target.value) {
          checkAvailability(e.target.value);
        } else {
          const timeSelect = document.querySelector('select[name="time"]');
          timeSelect.innerHTML = '<option value="">Sélectionner d\'abord une date</option>';
          timeSelect.disabled = true;
        }
      });

      // Form submission
      document.getElementById('appointmentForm').addEventListener('submit', handleFormSubmit);
    }

    async function checkAvailability(date) {
      const timeSelect = document.querySelector('select[name="time"]');
      const statusDiv = document.getElementById('availabilityStatus');
      
      statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Vérification des créneaux...';
      timeSelect.disabled = true;
      
      try {
        // This would normally call your API endpoint
        // const response = await fetch(`/api/appointments/availability?date=${date}`);
        // const slots = await response.json();
        
        // Mock availability data for demonstration
        const mockSlots = [
          { start: `${date}T09:00:00`, end: `${date}T10:00:00`, available: true },
          { start: `${date}T10:00:00`, end: `${date}T11:00:00`, available: false },
          { start: `${date}T11:00:00`, end: `${date}T12:00:00`, available: true },
          { start: `${date}T14:00:00`, end: `${date}T15:00:00`, available: true },
          { start: `${date}T15:00:00`, end: `${date}T16:00:00`, available: false },
          { start: `${date}T16:00:00`, end: `${date}T17:00:00`, available: true },
        ];
        
        availableSlots = mockSlots;
        populateTimeSlots(mockSlots);
        statusDiv.innerHTML = `<i class="fas fa-info-circle text-green-500"></i> ${mockSlots.filter(s => s.available).length} créneaux disponibles`;
        
      } catch (error) {
        console.error('Error checking availability:', error);
        statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle text-red-500"></i> Erreur lors de la vérification';
      }
    }

    function populateTimeSlots(slots) {
      const timeSelect = document.querySelector('select[name="time"]');
      timeSelect.innerHTML = '<option value="">Choisir un horaire</option>';
      
      slots.filter(slot => slot.available).forEach(slot => {
        const startTime = new Date(slot.start);
        const endTime = new Date(slot.end);
        const option = document.createElement('option');
        option.value = startTime.toTimeString().substr(0, 5);
        option.textContent = `${startTime.toTimeString().substr(0, 5)} - ${endTime.toTimeString().substr(0, 5)}`;
        timeSelect.appendChild(option);
      });
      
      timeSelect.disabled = false;
    }

    async function handleFormSubmit(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const originalContent = submitBtn.innerHTML;
      
      // Show loading state
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Réservation en cours...';
      submitBtn.disabled = true;
      
      try {
        const formData = new FormData(e.target);
        const appointmentData = {
          patientName: formData.get('patientName'),
          patientEmail: formData.get('patientEmail'),
          patientPhone: formData.get('patientPhone'),
          serviceType: selectedService,
          date: formData.get('date'),
          time: formData.get('time'),
          notes: formData.get('notes') || ''
        };

        // This would normally call your API endpoint
        // const response = await fetch('/api/appointments/book', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify(appointmentData)
        // });
        
        // Mock successful booking for demonstration
        setTimeout(() => {
          showStatusMessage('success', 'Votre rendez-vous a été réservé avec succès ! Vous recevrez un email de confirmation sous peu.');
          e.target.reset();
          selectedService = '';
          document.querySelectorAll('.service-card').forEach(card => {
            card.classList.remove('selected');
            card.querySelector('.check-icon').classList.add('hidden');
          });
          document.getElementById('selectedServiceInfo').classList.add('hidden');
          
          submitBtn.innerHTML = originalContent;
          submitBtn.disabled = false;
        }, 2000);
        
      } catch (error) {
        console.error('Booking error:', error);
        showStatusMessage('error', 'Une erreur s\'est produite lors de la réservation. Veuillez réessayer.');
        submitBtn.innerHTML = originalContent;
        submitBtn.disabled = false;
      }
    }

    function showStatusMessage(type, message) {
      const container = document.getElementById('statusMessages');
      const messageDiv = document.createElement('div');
      
      const bgColor = type === 'success' ? 'bg-green-50 border-green-200 text-green-700' : 'bg-red-50 border-red-200 text-red-700';
      const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
      
      messageDiv.className = `status-message p-6 rounded-2xl luxury-card ${bgColor} border`;
      messageDiv.innerHTML = `
        <div class="flex items-center gap-3">
          <i class="fas ${icon}"></i>
          <p class="font-medium">${message}</p>
        </div>
      `;
      
      container.innerHTML = '';
      container.appendChild(messageDiv);
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          messageDiv.remove();
        }, 5000);
      }
    }
  </script>
</body>
</html>